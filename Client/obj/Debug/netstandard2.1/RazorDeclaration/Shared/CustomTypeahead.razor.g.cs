#pragma checksum "/home/monchkrit/Code-House/blazormovieswasm/Client/Shared/CustomTypeahead.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "cb138dc30fd6173f26a3a52cbf81281ee2ecf91b"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace blazormovieswasm.Client.Shared
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Shared.Entities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Client.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "/home/monchkrit/Code-House/blazormovieswasm/Client/_Imports.razor"
using blazormovieswasm.Client.Repository;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "/home/monchkrit/Code-House/blazormovieswasm/Client/Shared/CustomTypeahead.razor"
using System.Timers;

#line default
#line hidden
#nullable disable
    public partial class CustomTypeahead<TItem> : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 48 "/home/monchkrit/Code-House/blazormovieswasm/Client/Shared/CustomTypeahead.razor"
       
  [Parameter] 
  public string Placeholder { get; set; }
  [Parameter]
  public int MinimumLength { get; set; } = 3;
  [Parameter]
  public int Debounce { get; set; } = 300;
  [Parameter]
  public Func<string, Task<IEnumerable<TItem>>> SearchMethod { get; set; }
  [Parameter] 
  public RenderFragment<TItem> ResultTemplate { get; set; }
  [Parameter]
  public RenderFragment NotFoundTemplate { get; set; }
  [Parameter]
  public EventCallback<TItem> ValueChanged { get; set; }

  private Timer _debounceTimer;
  private bool IsSearching = false;
  private bool IsShowingSuggestions = false;
  private string _searchText = string.Empty;
  protected TItem[] Suggestions { get; set; } = new TItem[0];

  protected override void OnInitialized()
  {
    _debounceTimer = new Timer();
    _debounceTimer.Interval = Debounce;
    _debounceTimer.AutoReset = false;
    _debounceTimer.Elapsed += Search;

    base.OnInitialized();
  }

  private bool ShowNotFound()
  {
    return !Suggestions.Any() && IsShowingSuggestions;
  }

  private async Task SelectSuggestion(TItem item)
  {
    SearchText = "";
    await ValueChanged.InvokeAsync(item);
  }

  protected async void Search(Object source, ElapsedEventArgs e)
  {
    IsSearching = true;
    IsShowingSuggestions = false;
    await InvokeAsync(StateHasChanged);

    Suggestions = (await SearchMethod.Invoke(_searchText)).ToArray();

    IsSearching = false;
    IsShowingSuggestions = true;
    await InvokeAsync(StateHasChanged);
  }

  private string SearchText
  {
    get => _searchText;
    set
    {
      _searchText = value;

      if (value.Length == 0)
      {
        IsShowingSuggestions = false;
        _debounceTimer.Stop();
        Suggestions = new TItem[0];
      }
      else if (value.Length >= MinimumLength)
      {
        _debounceTimer.Stop();
        _debounceTimer.Start();
      }
    }
  }

  private void ShowSuggestions()
  {
    if (Suggestions.Any())
    {
      IsShowingSuggestions = true;
    }
  }

  private void onfocusout()
  {
    if (!IsMouseInSuggestion)
    {      
      IsShowingSuggestions = false;
    }
  }

  private bool ShouldShowSuggestions()
  {
    return IsShowingSuggestions && Suggestions.Any();
  }

  bool IsMouseInSuggestion = false;

  private void OnmouseoverSuggestion()
  {
    IsMouseInSuggestion = true;
  }

  private void OnmouseoutSuggestion()
  {
    IsMouseInSuggestion = false;
  }

#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
